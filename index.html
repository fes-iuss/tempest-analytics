<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stormpire</title>
  
  <!-- Chart.js -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom right, #1e1e2f, #2c3e50);
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #111;
      padding: 1em;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header img {
      height: 60px;
    }
    header h1 {
      margin-left: 1em;
      font-size: 1.5em;
      flex: 1;
    }
    /* Navigation */
    nav {
      display: flex;
      justify-content: center;
      background-color: #222;
    }
    .nav-links { display: flex; }
    nav button {
      padding: 1em 2em;
      background: none;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1em;
    }
    nav button:hover,
    nav button.active {
      background-color: #444;
    }
    main {
      padding: 2em;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    .motto {
      text-align: center;
      font-size: 1.2em;
      margin-top: 0.5em;
      font-style: italic;
      color: #aaa;
    }

    /* Mobile nav toggle */
    .nav-toggle {
      display: none;
      background: none;
      color: #fff;
      border: 1px solid #444;
      padding: 0.5em 0.75em;
      border-radius: 6px;
      font-size: 1.25em;
      line-height: 1;
      cursor: pointer;
    }

    .leader-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 40px;
    }

    .leader-card {
      background-color: #222;
      border-radius: 8px;
      padding: 20px;
      flex: 1 1 45%;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      min-width: 300px;
    }

    .leader-title {
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 5px;
    }

    .leader-role {
      color: #aaa;
      font-style: italic;
      margin-bottom: 10px;
    }

    /* Main content area */
    .main {
      flex: 1;
      padding: 20px;
    }
    /*
    h1 {
      text-align: center;
      margin-bottom: 40px;
    }*/

    .chart-row {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 40px;
      margin-bottom: 40px;
    }

    .chart-container {
      flex: 1 1 45%;
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
    }

    canvas {
      width: 100% !important;
      height: auto !important;
    }

    a {
      color: white;
    }

    svg { max-width: 100%; height: auto; }
    .node rect { stroke: #fff; }
    .tooltip {
      position: absolute;
      text-align: left;
      background: rgba(0,0,0,0.75);
      color: #fff;
      padding: 6px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
    }
    #controls {
      margin-bottom: 10px;
    }
    #dateIndicator {
      font-weight: bold;
      margin-left: 10px;
    }

    @media only screen and (max-width: 768px) {
      header { position: sticky; top: 0; z-index: 1000; }
      .nav-toggle { display: inline-block; }
      /* Collapse nav by default on small screens */
      nav { display: none; }
      nav.open { display: block; }
      nav { background-color: #222; }
      .nav-links { flex-direction: column; }
      nav button { width: 100%; text-align: left; padding: 1em; border-top: 1px solid #333; }
      .motto { margin: 0.5em 1em; }
    }
  </style>
</head>
<body>

  <header>
    <img src="img/logo.png" alt="Stormpire Logo" />
    <h1>Stormpire</h1>
    <button id="navToggle" class="nav-toggle" aria-controls="primary-nav" aria-expanded="false" aria-label="Toggle navigation">☰</button>
  </header>
  <div class="motto">"For the Stormpire"</div>

  <nav id="primary-nav">
    <div class="nav-links">
      <button class="tab-btn active" onclick="showTab('home')">Home</button>
      <button class="tab-btn" onclick="showTab('history')">History</button>
      <button class="tab-btn" onclick="showTab('about')">About Us</button>
      <button class="tab-btn" onclick="showTab('discord')">Discord</button>
      <button class="tab-btn" onclick="showTab('analytics')">Analytics</button>
      <button class="tab-btn" onclick="showTab('store')">Store</button>
    </div>
  </nav>

  <main>
    <section id="home" class="active">
      <h2>Welcome to Stormpire</h2>
      <p>We are an elite force forged in the heart of battle and sharpened by strategy. As a top-tier alliance in Kingshot, we dominate the leaderboards with ruthless precision, tactical coordination, and unbreakable loyalty. Whether it's PvP, raids, or large-scale alliance wars, we bring the storm.</p>
      <p>This isn’t just a clan — it’s a brotherhood. A proving ground. A war machine.</p>
      <p>If you're looking for casual play, keep scrolling. If you're looking to rise with the best - welcome to The Stormpire.</p>
    </section>

    <section id="history">
      <h2>History</h2> 
      <p>The Stormpire is more than just a set of elite gaming alliances - it is a force of nature. Forged in fire, tempered by war, and united under a single banner, we are warriors, tacticians, and champions of conquest. We battle for our homeland - the Stormpire - and carry its name into every arena with thunder at our backs.</p>
      <hr>

      <h2>Where It All Began</h2>
      <p>Our story begins with Empire — the original alliance founded in early 2025 by the visionary and battle-hardened leader, Boondock. Under his command, Empire rose quickly, cutting a path through Kingshot with relentless precision. Boondock wasn’t just a founder — he was a symbol of strength, leading from the front and inspiring a new generation of fighters to stand tall in the face of impossible odds.</p>
      <p>But Boondock had a greater vision — not just for victory, but for unity. In an unprecedented move, Empire joined forces with the formidable warriors of Stormforged, a powerful ally known for their raw aggression and strategic cunning.</p>
      <p>This was not a compromise — it was an evolution.</p>
      <hr>

      <h2>The Birth of the Storm</h2>
      <p>From the fusion of Empire and Stormforged, a new alliance emerged: The Tempest. More than the sum of its parts, Tempest was born not in peace, but in the eye of the storm - and it has only grown more powerful since.</p>
      <p>Boondock’s legacy lives on, honored by every member who fights under the banner he helped raise. As our ranks swelled and our influence expanded, command was passed to a new leader — Junebug, our current R5, a master tactician and charismatic unifier. With Boondock’s fire and Junebug’s mind, we don’t just survive — we dominate.</p>
      <hr>

      <h2>The Rise of Stormpire</h2>
      <p>As Tempest’s might grew, its reach extended beyond borders. It was Boondock once again who brokered the next great turning point: the unification with the proud Europe Alliance. Known for their discipline, precision, and unmatched resilience, the European warriors brought a new dimension to the battlefield. The merger was not a simple alliance — it was the forging of a dynasty.</p>
      <p>With Tempest at its core, the Europe Alliance by its side, and a rising third arm of dedicated allies rallying under the same thunderous banner, the <strong>Stormpire</strong> was born. What began as one alliance had become three — a triad of power, united in name, spirit, and purpose.</p>
      <p>The Stormpire was not just a group of alliances — it was a declaration to every rival: we are inevitable, we are unbreakable, and when the storm comes, it comes for all.</p>
      <hr>

      <h2>Who We Are Now</h2>
      <p>Today, The Stormpire is a disciplined war machine and a brotherhood of players who refuse to be average. We are battle-hardened veterans and hungry new blood, strategists and shock troops, scouts and siege masters. We communicate. We adapt. We strike fast and hit hard.</p>
      <p>Whether in PvP skirmishes, kingdom-spanning wars, or the defense of the Stormpire itself, we fight as one — not just for glory, but for each other.</p>

      <br>
      <hr>
      <p>We were Empire. We became the Tempest.</p>
      <p>We are the Stormpire.</p>
      <p>Join us — and become the storm.</p>
      <hr>
    </section>

    <section id="about">
      <h2>About Us</h2>
      <h2>The Command Council – Our Leadership</h2>
      <p>At the heart of The Stormpire stands a council of leaders forged by fire, loyalty, and war. These are not just ranks - they are the soul of the Stormpire. Each commander brings a unique strength to the table, making our alliance unstoppable in both strategy and spirit.</p>
      <div class="leader-grid">
        <div class="leader-card">
          <div class="leader-title"><a href="boondock.html">Boondock</a></div>
          <div class="leader-role">The Founder, The Flamebearer</div>
          <p>Boondock is the visionary who built the foundation of Stormpire. Philosopher and tactician, his legacy continues in every move we make.</p>
        </div>
      </div>
      <hr>
      <h2>Tempest</h2>
      <div class="leader-grid">
        <div class="leader-card">
          <div class="leader-title"><a href="junebug.html">Junebug</a></div>
          <div class="leader-role">The Storm Commander (R5)</div>
          <p>Strategist. Unifier. Relentless. As the current R5, Junebug leads with discipline and instinct. He carries Boondock’s legacy with force and precision. He doesn't just command the storm — he <em>is</em> the storm.</p>
        </div>
        <div class="leader-card">
          <div class="leader-title"><a href="defender.html">Defender</a></div>
          <div class="leader-role">The Shield of the Alliance</div>
          <p>Loyal, brave, and dependable, Defender stands between danger and the Stormpire. A true protector of the realm.</p>
        </div>
        <div class="leader-card">
          <div class="leader-title"><a href="pimpchicken.html">Pimpchicken</a></div>
          <div class="leader-role">The Shadow and the Shield</div>
          <p>Smart, strong, and always ready, Pimpchicken is both warrior and spy. Whether it’s intel or impact, he delivers exactly what the alliance needs — when it needs it.</p>
        </div>
        <div class="leader-card">
          <div class="leader-title"><a href="dirty_work.html">Dirty_Work</a></div>
          <div class="leader-role">The Blade of the Stormpire</div>
          <p>Ruthless in combat and fearless in approach, Dirty_Work leads by action. When the battle cries out, she answers first — and hits hard.</p>
        </div>
        <div class="leader-card">
          <div class="leader-title"><a href="opt2mst.html">Opt2mst Prime</a></div>
          <div class="leader-role">The Architect of Order</div>
          <p>Organized, kind, and calm under pressure, Opt2mst is a steady hand in turbulent times. His leadership keeps the alliance focused and always ready for war.</p>
        </div>
        <div class="leader-card">
          <div class="leader-title"><a href="livelight.html">LiveLight</a></div>
          <div class="leader-role">The Voice of the Storm</div>
          <p>Our scribe and signal fire, LiveLight keeps the Stormpire informed and aligned. She ensures no one is left in the dark — or the dust.</p>
        </div>
        <div class="leader-card">
          <div class="leader-title">Fes</div>
          <div class="leader-role">The Hatman</div>
          <p>He wears hats. Many hats. All of them excellent.</p>
        </div>
      </div>
      <hr>
      <h2>TurnItUp</h2>
      <div class="leader-grid">
        <div class="leader-card">
          <div class="leader-title">Falcon</div>
          <div class="leader-role">Birdman</div>
          <p></p>
        </div>
        <div class="leader-card">
          <div class="leader-title">JibJab</div>
          <div class="leader-role">The Brit</div>
          <p></p>
        </div>
      </div>
      <hr>
      <h2>TinyTempest</h2>
      <div class="leader-grid">
        <div class="leader-card">
          <div class="leader-title">Skull60</div>
          <div class="leader-role">Skeletor</div>
          <p></p>
        </div>
        <div class="leader-card">
          <div class="leader-title">DoofusCat</div>
          <div class="leader-role">The Cat</div>
          <p></p>
        </div>
        <div class="leader-card">
          <div class="leader-title">James</div>
          <div class="leader-role"></div>
          <p></p>
        </div>
        <div class="leader-card">
          <div class="leader-title">Uncle Phil</div>
          <div class="leader-role"></div>
          <p></p>
        </div>
      </div>
    </section>


    <section id="discord">
      <h2>Join Us on Discord</h2>
      <p>Our Discord server is the heart of our operations. Chat, strategize, and laugh with fellow members.</p>
      <p><strong>Invite Link:</strong> <a href="https://discord.com/invite/3AK4t9wFKb" target="_blank">https://discord.gg/3AK4t9wFKb</a></p>
    </section>

    <section id="analytics">
      <h2>Analytics Dashboard</h2>
      <div class="main">
        <h1>Bear Hunt Summary</h1>

        <!-- Top Row -->
        <div class="chart-row">
          <div class="chart-container">
              <canvas id="comboChart"></canvas>
          </div>
          <div class="chart-container">
              <canvas id="dualDamageChart"></canvas>
          </div>
        </div>

        <!-- Bottom Row -->
        <div class="chart-row">
          <div class="chart-container">
              <canvas id="totalDamageChart"></canvas>
          </div>
          <div class="chart-container">
              <canvas id="avgDamageChart"></canvas>
          </div>
        </div>

        <!-- Bottom Horizontal Bar-->
        <!-- <div class="chart-container wide">
          <canvas id="memberDamageChart"></canvas>
        </div> -->

        <h2>Damage Treemap - Running Total</h2>
          <div id="controls">
            <button id="resetBtn">Reset Animation</button>
            <span id="dateIndicator"></span>
          </div>
          <div id="chart"></div>
      </div>
    </section>
    <section id="store">
      <h2>Stormpire Store</h2>
      <p>Support the Stormpire and represent the alliance with official gear.</p>

      <div class="leader-grid">
        <div class="leader-card">
          <div style="display:flex;justify-content:space-between;gap:4px;">
            <img src="img/logo-tmp-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
            <img src="img/logo-tnp-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
            <img src="img/logo-tnt-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
          </div>
          <div class="leader-title">Emblem Tee</div>
          <div class="leader-role">Soft cotton • Black</div>
          <p>Clean front emblem. Everyday comfort built for battle.</p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
            <span style="font-weight:bold;">$24.99</span>
            <a href="#" style="padding:8px 14px;background:#28a745;color:#fff;text-decoration:none;border-radius:4px;">Buy</a>
          </div>
        </div>

        <div class="leader-card">
          <div style="display:flex;justify-content:space-between;gap:4px;">
            <img src="img/logo-tmp-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
            <img src="img/logo-tnp-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
            <img src="img/logo-tnt-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
          </div>
          <div class="leader-title">Alliance Hoodie</div>
          <div class="leader-role">Midweight • Fleece-lined</div>
          <p>Stay warm on campaign. Minimal branding, maximum comfort.</p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
            <span style="font-weight:bold;">$44.99</span>
            <a href="#" style="padding:8px 14px;background:#28a745;color:#fff;text-decoration:none;border-radius:4px;">Buy</a>
          </div>
        </div>

        <div class="leader-card">
          <div style="display:flex;justify-content:space-between;gap:4px;">
            <img src="img/logo-tmp-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
            <img src="img/logo-tnp-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
            <img src="img/logo-tnt-white.png" alt="Stormpire Holo Sticker" style="width:32%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
          </div>
          <div class="leader-title">Holo Sticker Pack</div>
          <div class="leader-role">3-pack • Weatherproof</div>
          <p>Badge your rig, bottle, or journal with Stormpire shine.</p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
            <span style="font-weight:bold;">$7.99</span>
            <a href="#" style="padding:8px 14px;background:#28a745;color:#fff;text-decoration:none;border-radius:4px;">Buy</a>
          </div>
        </div>

        <div class="leader-card">
          <img src="img/logo.png" alt="Stormpire Guess Who" style="width:100%;max-height:160px;object-fit:contain;margin-bottom:12px;background:#111;border-radius:6px;" />
          <div class="leader-title">Stormpire Guess Who</div>
          <div class="leader-role">Guess Who: the Game</div>
          <p>Test your knowledge of the Stormpire universe with this fun twist on the classic game.</br>
             (Spoiler Alert: it's Chenko.)</p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
            <span style="font-weight:bold;">$19.99</span>
            <a href="#" style="padding:8px 14px;background:#28a745;color:#fff;text-decoration:none;border-radius:4px;">Buy</a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    const data = [
      { date: '7/5/2025', rallies: 34, totalDamage: 84354866, avgDamage: 2481025.471 },
      { date: '7/7/2025', rallies: 59, totalDamage: 189134043, avgDamage: 3205661.746 },
      { date: '7/9/2025', rallies: 51, totalDamage: 177480213, avgDamage: 3480004.176 },
      { date: '7/11/2025', rallies: 41, totalDamage: 163228840, avgDamage: 3981191.22 },
      { date: '7/13/2025', rallies: 53, totalDamage: 243204676, avgDamage: 4588767.472 },
      { date: '7/15/2025', rallies: 64, totalDamage: 347881427, avgDamage: 5435647.297 },
      { date: '7/17/2025', rallies: 57, totalDamage: 441002978, avgDamage: 7736894.351 },
      { date: '7/19/2025', rallies: 60, totalDamage: 505465361, avgDamage: 8424422.683 },
      { date: '7/21/2025', rallies: 48, totalDamage: 730164014, avgDamage: 15211750.29 },
      { date: '7/23/2025', rallies: 42, totalDamage: 673438211, avgDamage: 16034243.12 },
      { date: '7/25/2025', rallies: 42, totalDamage: 653376256, avgDamage: 15556577.52 },
      { date: '7/27/2025', rallies: 56, totalDamage: 909014957, avgDamage: 16232409.95 },
      { date: '7/30/2025', rallies: 57, totalDamage: 969316059, avgDamage: 17005544.8947368 },
      { date: '8/1/2025', rallies: 60, totalDamage: 1221426445, avgDamage: 20357107.4166667 },
      { date: '8/3/2025', rallies: 65, totalDamage: 1209921742, avgDamage: 18614180.6461538 },
      { date: '8/5/2025', rallies: 60, totalDamage: 1254988688, avgDamage: 20916478.1333333 },
      { date: '8/8/2025', rallies: 53, totalDamage: 1521002279, avgDamage: 28698156.2075472 },
      { date: '8/10/2025', rallies: 73, totalDamage: 1665192981, avgDamage: 22810862.7534247 },
      { date: '8/12/2025', rallies: 73, totalDamage: 1706164408, avgDamage: 23372115.1780822 },
      { date: '8/14/2025', rallies: 73, totalDamage: 2145056895, avgDamage: 29384341.0273973 },
      { date: '8/16/2025', rallies: 63, totalDamage: 2308456491, avgDamage: 36642166.5238095 },
      { date: '8/18/2025', rallies: 91, totalDamage: 2746359465, avgDamage: 30179774.3406593 },
      { date: '8/20/2025', rallies: 86, totalDamage: 2731722176, avgDamage: 31764211.3488372 },

   ];

    const labels = data.map(item => item.date);
    const rallies = data.map(item => item.rallies);
    const totalDamage = data.map(item => item.totalDamage);
    const avgDamage = data.map(item => item.avgDamage);

    // Combo Chart
    new Chart(document.getElementById("comboChart"), {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {
            type: 'bar',
            label: 'Rallies',
            data: rallies,
            backgroundColor: 'rgba(54, 162, 235, 0.6)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1,
            yAxisID: 'y'
          },
          {
            type: 'line',
            label: 'Total Damage',
            data: totalDamage,
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderWidth: 2,
            tension: 0.3,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Rallies (Bar) and Total Damage (Line)',
            font: { size: 18 }
          }
        },
        scales: {
          y: {
            type: 'linear',
            position: 'left',
            title: { display: true, text: 'Rallies' }
          },
          y1: {
            type: 'linear',
            position: 'right',
            title: { display: true, text: 'Total Damage' },
            grid: { drawOnChartArea: false },
            ticks: {
              callback: value => value.toLocaleString()
            }
          }
        }
      }
    });

    // Total Damage
    new Chart(document.getElementById("totalDamageChart"), {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Total Damage',
          data: totalDamage,
          borderColor: '#dc3545',
          backgroundColor: '#dc3545',
          tension: 0.3,
          pointBackgroundColor: '#dc3545'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Total Damage Over Time',
            font: { size: 18 }
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            ticks: {
              callback: value => value.toLocaleString()
            }
          }
        }
      }
    });

    // Average Damage
    new Chart(document.getElementById("avgDamageChart"), {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'Average Damage',
          data: avgDamage,
          borderColor: '#28a745',
          backgroundColor: '#28a745',
          tension: 0.3,
          pointBackgroundColor: '#28a745'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Average Damage Over Time',
            font: { size: 18 }
          }
        },
        scales: {
          y: {
            beginAtZero: false,
            ticks: {
              callback: value => value.toLocaleString()
            }
          }
        }
      }
    });

    // Dual Damage Chart
    new Chart(document.getElementById("dualDamageChart"), {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: 'Total Damage',
            data: totalDamage,
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            yAxisID: 'y1',
            tension: 0.3
          },
          {
            label: 'Average Damage',
            data: avgDamage,
            borderColor: 'rgba(40, 167, 69, 1)',
            backgroundColor: 'rgba(40, 167, 69, 0.2)',
            yAxisID: 'y2',
            tension: 0.3
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Total vs. Average Damage (Dual Axes)',
            font: { size: 18 }
          }
        },
        scales: {
          y1: {
            type: 'linear',
            position: 'left',
            title: { display: true, text: 'Total Damage' },
            ticks: {
              callback: value => value.toLocaleString()
            }
          },
          y2: {
            type: 'linear',
            position: 'right',
            title: { display: true, text: 'Average Damage' },
            grid: { drawOnChartArea: false },
            ticks: {
              callback: value => value.toLocaleString()
            }
          }
        }
      }
    });

    const width = 800;
    const height = 800;

    const svg = d3.select("#chart").append("svg")
      .attr("width", width)
      .attr("height", height);

    const treemap = d3.treemap().size([width, height]).padding(1);

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    let dates, members, runningTotals, i, timer, rawData;

    function update(dayIndex) {
      const day = dates[dayIndex];
      document.getElementById("dateIndicator").textContent = `Date: ${day}`;

      rawData.filter(d => d.date === day).forEach(d => runningTotals[d.member] += d.damage);

      const data = {
        name: "root",
        children: members.map(m => ({ name: m, value: runningTotals[m] }))
      };

      const root = d3.hierarchy(data).sum(d => d.value);
      treemap(root);

      const nodes = svg.selectAll("g").data(root.leaves(), d => d.data.name);

      const enter = nodes.enter().append("g")
        .attr("transform", d => `translate(${d.x0},${d.y0})`);

      enter.append("rect")
        .attr("fill", d => color(d.data.name))
        .attr("width", d => d.x1 - d.x0)
        .attr("height", d => d.y1 - d.y0)
        .on("mouseover", (event, d) => {
          tooltip.transition().duration(200).style("opacity", 0.9);
          tooltip.html(`<strong>${d.data.name}</strong><br/>Damage: ${d3.format(",")(d.value)}`)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", () => tooltip.transition().duration(500).style("opacity", 0));

      enter.append("text")
        .attr("x", 4)
        .attr("y", 14)
        .append("tspan")
        .text(d => d.data.name)
        .attr("x", 4)
        .attr("dy", 0);

      enter.select("text")
        .append("tspan")
        .text(d => d3.format(",")(d.value))
        .attr("x", 4)
        .attr("dy", 14);

      nodes.transition().duration(800)
        .attr("transform", d => `translate(${d.x0},${d.y0})`)
        .select("rect")
        .attr("width", d => d.x1 - d.x0)
        .attr("height", d => d.y1 - d.y0);

      nodes.select("text tspan:nth-child(1)").text(d => d.data.name);
      nodes.select("text tspan:nth-child(2)").text(d => d3.format(",")(d.value));
    }

    function startAnimation() {
      svg.selectAll("g").remove();
      runningTotals = Object.fromEntries(members.map(m => [m, 0]));
      i = 0;
      if (timer) timer.stop();
      timer = d3.interval(() => {
        update(i);
        i++;
        if (i >= dates.length) timer.stop();
      }, 1500);
    }

    d3.json("assets/data.json").then(data => {
      rawData = data;
      dates = [...new Set(rawData.map(d => d.date))].sort((a,b) => new Date(a) - new Date(b));
      members = [...new Set(rawData.map(d => d.member))];
      color = d3.scaleOrdinal().domain(members).range(d3.schemeCategory10);

      document.getElementById("resetBtn").addEventListener("click", startAnimation);
      startAnimation();
    });

    // Mobile navigation toggle
    const navToggleBtn = document.getElementById('navToggle');
    if (navToggleBtn) {
      navToggleBtn.addEventListener('click', () => {
        // Scroll to top when the menu toggle is clicked
        try {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        } catch (_) {
          // Fallback for older browsers
          window.scrollTo(0, 0);
        }
        const nav = document.getElementById('primary-nav');
        if (!nav) return;
        const isOpen = nav.classList.toggle('open');
        navToggleBtn.setAttribute('aria-expanded', String(isOpen));
      });
    }

    function showTab(tabId) {
      // Hide all sections
      document.querySelectorAll("section").forEach(section => {
        section.classList.remove("active");
      });

      // Remove active class from all buttons
      document.querySelectorAll(".tab-btn").forEach(btn => {
        btn.classList.remove("active");
      });

      // Show selected section
      document.getElementById(tabId).classList.add("active");

      // Highlight active tab
      const clickedButton = Array.from(document.querySelectorAll(".tab-btn")).find(btn =>
        btn.textContent.toLowerCase().includes(tabId)
      );
      if (clickedButton) clickedButton.classList.add("active");

      // Close the mobile menu after selection
      const nav = document.getElementById('primary-nav');
      const toggleBtn = document.getElementById('navToggle');
      if (window.matchMedia('(max-width: 768px)').matches) {
        nav && nav.classList.remove('open');
        if (toggleBtn) toggleBtn.setAttribute('aria-expanded', 'false');
      }
    }
  </script>

</body>
</html>
